
<button mat-icon-button class="back-button" (click)="onBack()"> <mat-icon>arrow_back</mat-icon> </button>
<div class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 style="color: #663c1f;" class="mb-0 fw-bold">Meus Ingressos</h2>
        <span style="background-color: #663c1f;" class="badge fs-6">{{ ingressos.length }} ingressos</span>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div *ngFor="let ingresso of paginatedIngressos" class="col-12 col-md-6 col-lg-4">
      <mat-card class="ingresso-card h-100 shadow-sm">
        <mat-card-header class="pb-3">
          <div class="d-flex justify-content-between align-items-start w-100">
            <div>
              <mat-card-title class="fs-6 fw-bold text-truncate">
                {{ ingresso.usuario.nome }}
              </mat-card-title>
              <mat-card-subtitle class="text-muted small">
                #{{ ingresso.id }}
              </mat-card-subtitle>
            </div>
            <mat-chip variant="outlined" class="small">
              {{ ingresso.status | titlecase }}
            </mat-chip>
          </div>
        </mat-card-header>

        <mat-card-content>
          <div class="info-section mb-3">
            <div class="d-flex align-items-center mb-2">
              <mat-icon class="text-muted me-2" style="font-size: 18px; width: 18px; height: 18px;">event</mat-icon>
              <span class="small">{{ ingresso.dataUtilizacao | date:'dd/MM/yyyy - HH:mm' }}</span>
            </div>
            <div class="d-flex align-items-center">
              <mat-icon class="text-muted me-2" style="font-size: 18px; width: 18px; height: 18px;">location_on</mat-icon>
              <span class="small text-truncate">Av. Brasília Formosa - Recife, PE</span>
            </div>
          </div>

          <div class="qr-section text-center py-3 border-top border-bottom">
            <div class="qr-code mx-auto mb-2">
              {{ ingresso.cpfToken | slice:0:8 }}
            </div>
            <small class="text-muted">Código do ingresso</small>
          </div>

          <div class="cpf-section text-center py-2">
            <small class="text-muted">CPF: {{ formatCpf(ingresso.usuario.cpf) }}</small>
          </div>
        </mat-card-content>

        <mat-card-actions class="d-flex justify-content-between px-3 pb-3">
          <button mat-button
                  color="primary"
                  class="flex-grow-1 me-2"
                  (click)="update(ingresso)">
            <mat-icon>edit</mat-icon>
            Editar
          </button>

          <button mat-icon-button
                  [matMenuTriggerFor]="menu"
                  class="more-actions">
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="shareIngresso(ingresso)">
              <mat-icon>share</mat-icon>
              <span>Compartilhar</span>
            </button>
            <button mat-menu-item (click)="downloadIngresso(ingresso)">
              <mat-icon>download</mat-icon>
              <span>Download</span>
            </button>
            <button mat-menu-item
                    color="warn"
                    (click)="delete(ingresso)">
              <mat-icon color="warn">delete</mat-icon>
              <span>Excluir</span>
            </button>
          </mat-menu>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <mat-paginator [length]="ingressos.length"
                     [pageSize]="pageSize"
                     [pageSizeOptions]="pageSizeOptions"
                     [pageIndex]="currentPage"
                     (page)="onPageChange($event)"
                     class="custom-paginator">
      </mat-paginator>
    </div>
  </div>

  <div *ngIf="ingressos.length === 0" class="row mt-5">
    <div class="col-12 text-center">
      <mat-icon class="display-1 text-muted mb-3">confirmation_number</mat-icon>
      <h4 class="text-muted">Nenhum ingresso encontrado</h4>
      <p class="text-muted">Você ainda não possui ingressos cadastrados.</p>
    </div>
  </div>
</div>
